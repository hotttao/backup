---
title: 3. redis 原理篇
date: 2020-05-03
categories:
    - 存储
tags:
    - Kafka
---

Redis 原理篇

<!-- more -->

## 1. 原理篇概述
原理篇我们将介绍 Redis 的如下内容:
- IO模型
- 网络协议
- 持久化
- 管道
- 事务
- 小对象压缩

## 1. IO 模型

## 2. 通信协议

## 3. 持久化

## 4. 管道

## 5. Redis 事务
Redis 如下命令用于启动事务:
1. multi: begin 开启事务
2. exec: commit 提交
3. discard: rollback 回滚

所有的指令在 exec 之前不执行，而是缓存在服务器的一个事务队列中，服务器一旦收到 exec 指令，才开始执行整个事务队列，执行完成之后一次性返回所有指令的运行结果。

但是 **Redis的事务不具备原子性**，当事务中的一连串命令，发生错误时，发生错误的指令不会影响接下来的其他指令的运行，更不会回滚。Redis 是单线程，准确来说它仅仅满足事务隔离性中的串行化。

discard 作用仅仅是丢弃事务队列里的命名。此处不存在回滚一说，因为命令压根没有执行。

```bash
> multi
> incr books
> incr books
> exec
```

为了避免事务中多次发送命令带来了多次网络开销，通常事务与管道一起使用。

```bash
pip = redis.pipeline(transaction=True)
pipe.multi()
pipe.incr("books")
values = pipe.execute()
```

## 6. 小对象压缩
