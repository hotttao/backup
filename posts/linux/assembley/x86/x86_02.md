---
title: 2. 硬件系统的结构
date: 2021-07-02
categories:
    - Go
tags:
	- x86 汇编
---

汇编语言是直接在硬件上工作的编程语言，我们首先要了解硬件系统的结构，下面内容是[汇编语言(第3版)](https://book.douban.com/subject/25726019/)前三章的读书笔记。
<!-- more -->

## 1. 硬件系统结构
我们都知道一台计算机有 CPU、存储器、外围芯片组、扩展插槽组成。扩展插槽上一般插有 RAM 内存条和各种接口卡。这些器件都在 PC 机中的**主板**上，它们通过总线相连。接口卡和存储器是需要我们理解的两个重要概念。

### 1.1 接口卡
所谓**接口卡**，是计算上直接控制**外部设备**(如显示器、音箱、打印机)的部件。**接口卡插在扩展插槽上，通过总线和 CPU 相连**，CPU 可以直接控制这些接口卡，从而时间对外设的简介控制。简单来说就是 CPU 通过总线向接口卡发送命令，接口卡根据 CPU 指令控制外设进行工作。

### 1.2 存储器
一台 PC 机中，装有多个存储器芯片，不仅仅只是内存。这些存储器从功能和连接上可以分为以下几类:
1. 随机存储器(内存)
    - 用于存放供 CPU 使用的绝大部分程序和数据，
    - 主随机存储器一般由装在主板上的 RAM和插在扩展槽上的RAM
2. BIOS(Basic Input/Output System)的 ROM
    - BOIS 是有主板和各类接口卡(显卡、网卡等)厂商提供的软件系统
    - BOIS 提供了操作硬件设备的基本接口
    - **在主板和某些接口卡上插有存储相应 BOIS 的 ROM**(只读存储器)
3. 接口卡上的 RAM
    - 某些接口卡需要对大批量输入、输出数据进行暂时存储，其上装有 RAM
    - 最典型的是显卡上的 RAM，一般称为显存

下面展示了 PC 系统中各种存储器的逻辑连接情况。


![PC 系统中各种存储器的逻辑连接情况](/images/assembly/cpu_ram_rom.jpg)

### 1.3 内存地址空间
上述这些存储器，在物理上是独立的，但是有以下两点相同:
1. 都和 CPU 的总线相连
2. CPU 对他们进行读或写的时候都**通过控制线**发出**内存读写命令**

也就是说，CPU 在操控他们的时候，把它们都当做内存对待，把它们总的看作一个由若干存储单元组成的逻辑存储器，这个逻辑存储器就是我们所说的**内存地址空间**。

下图展示了 CPU 将系统中各类存储器看作一个逻辑存储器的情况:

![PC 逻辑存储器](/images/assembly/basic_rom_ram.png)

所有物理存储器被看作一个由若干存储单元组成的逻辑存储器，每个物理存储器在这个逻辑存储器中占有一个**地址段**，即一段**地址空间**。CPU 在这个地址段内读写数据，实际上就是在相应的物理存储器中读写数据。

#### 8086PC内存地址空间
我们在基于一个计算机硬件系统编程的时候，必须知道这个系统中的**内存地址空间**分配情况。8086PC机内存地址空间分配的基本情况如下:

![8086 内存地址空间](/images/assembly/8086.png)

其中:
1. 0-9FFFF: 对应主随机存储，即我们常说的内存
2. A0000-BFFFF: 对应显存
3. C0000-FFFFF: 对应各种 BOIS ROM

## 2. CPU 对存储器的读写
说完了存储器，我们在来简单聊聊 CPU 对存储器的读写。CPU 要想进行数据读写，必须和存储器进行下面 3 类信息的交互:
1. 存储单元的地址，即**地址信息**
2. 器件的选择，读或写的命名，即**控制总线**
3. 读或写的数据，即数据信息

CPU 和存储器通过总线相连，根据传送信息的不同，总线从逻辑上分为: **地址总线、控制总线、数据总线**。

对于汇编指令 `mv AX [3]`，CPU 读取数据的过程如下:
1. CPU 通过地址总线将地址信息 3 发出
2. CPU 通过控制总线发出读命名，选中存储器，通知其将读取数据
3. 存储器将 3 号单元中的数据 8 通过数据总线送入 CPU

![CPU 从内存读取数据的过程](/images/assembly/cpu-read-data-from-memory.png)

所以:
1. 地址总线的宽度决定了 CPU的寻址能力
2. 数据总线决定了 CPU 与外界的数据传送速度
3. 控制总线的宽度决定了 CPU 对外部器件的控制能力

有关 PC 的系统结构我们就讲到这，下一篇文章我们来准备汇编的编程环境。