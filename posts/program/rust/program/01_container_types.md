---
weight: 1
title: "Rust 复合数据类型"
date: 2023-05-01T22:00:00+08:00
lastmod: 2023-05-01T22:00:00+08:00
draft: false
author: "宋涛"
authorLink: "https://hotttao.github.io/"
description: "Rust 所有权"
featuredImage: 

tags: ["rust 语法"]
categories: ["Rust"]

lightgallery: true

toc:
  auto: false
---

## 1. String 实现
问: 以简化代码的形式，描述 rust String 的数据结构

Rust 中的 `String` 数据结构可以简化为以下代码：

```rust
pub struct String {
    ptr: *mut u8,  // 指向字符串数据的指针
    len: usize,    // 字符串长度
    capacity: usize,  // 字符串当前分配的容量
}
```

在这个简化的表示中，`String` 结构体包含了三个字段：

- `ptr`：一个指向堆上存储字符串数据的指针，类型为 `*mut u8`。通过这个指针，可以访问字符串的字节数据。
- `len`：一个表示字符串的实际长度的字段，类型为 `usize`。它表示字符串的有效字符数，不包括结尾的空字符。
- `capacity`：一个表示当前分配的堆内存容量的字段，类型为 `usize`。它表示字符串目前可以容纳的最大字符数，超过这个容量时，需要重新分配更大的内存。

### 1.1 str 和 String
####  str 与 String
问: rust 中的 str 与 String

在 Rust 中，`str` 和 `String` 是用于表示文本数据的两种不同类型。

`str` 是一个不可变的字符串切片类型，它是对存储在其他位置的 UTF-8 编码字符串数据的引用。`str` 类型通常通过字符串字面量或通过引用其他 `String` 或 `str` 对象创建。

```rust
let s: &str = "Hello, world!";  // 字符串字面量创建 str
let s2: &str = &s[0..5];        // 从现有的 str 中创建子切片
```

`String` 是一个可变的、堆分配的字符串类型，它允许动态修改和拥有其内容。`String` 类型提供了多种方法来修改、追加、拼接字符串等操作。

```rust
let mut s: String = String::from("Hello"); // 使用 from 方法创建 String
s.push_str(", world!");                    // 追加字符串
```

`String` 类型可以根据需要动态调整大小，因为它在堆上分配了足够的内存来容纳字符串的内容。

需要注意的是，`String` 可以通过使用 `&` 运算符转换为 `&str`，这允许在某些情况下使用 `String` 对象的不可变引用。

```rust
let s: String = String::from("Hello");
let s2: &str = &s;  // 将 String 转换为 &str
```

总结起来，`str` 是不可变的字符串切片类型，而 `String` 是可变的、堆分配的字符串类型，用于动态处理和修改字符串数据。`str` 常用于函数参数和引用传递，而 `String` 常用于需要动态修改字符串内容的场景。

#### 字符串字面量、str 与 String
问: 表格形式对比 rust 中是字符串字面量、str、String，包括他们的特性、内部处理方式

下面是对 Rust 中字符串字面量、`str` 和 `String` 进行特性、内部处理方式的对比：

| 特性 | 字符串字面量 | `str` | `String` |
|-----|--------------|------|---------|
| 可变性 | 不可变 | 不可变 | 可变 |
| 存储位置 | 编译时决定，通常是静态存储区 | 可以是任何地方，通常是栈上或静态存储区 | 堆上 |
| 分配方式 | 字符串字面量在编译时直接分配 | 引用其他地方的 UTF-8 字符串数据 | 动态分配内存 |
| 大小调整 | 固定大小，不可修改 | 固定大小，不可修改 | 动态调整大小 |
| 内容修改 | 不可修改 | 不可修改 | 可以修改 |
| 长度计算 | 在编译时已知 | 在运行时计算 | 在运行时计算 |
| 生命周期 | 无需生命周期标注，编译器自动推断 | 有生命周期，与引用的对象绑定 | 有生命周期，与变量绑定 |
| 字符串连接 | 编译时可进行字符串字面量拼接 | 使用字符串切片的拼接操作或 `to_string` 方法 | 使用 `push_str`、`push` 或 `+` 等方法 |
| 复制 | 具有 `Copy` trait，可以进行值复制 | 不具备 `Copy` trait，只能通过引用传递 | 不具备 `Copy` trait，只能通过引用传递 |
| 适用场景 | 静态、不可变的字符串常量 | 不可变的字符串引用或切片 | 动态、可变的字符串，需要进行修改和拥有权 |

这些特性和内部处理方式的区别使得字符串字面量、`str` 和 `String` 在不同的情况下具有不同的用途。字符串字面量适用于静态且不可变的字符串常量，`str` 适用于引用和处理已有的字符串数据，而 `String` 则适用于需要动态修改和拥有字符串内容的场景。选择适当的类型取决于具体的需求和操作。